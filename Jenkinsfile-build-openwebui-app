pipeline {
    agent any

    environment {
        IMAGE_NAME = credentials('IMAGE_NAME')
        IMAGE_TAG = credentials('IMAGE_TAG')
        AWS_REGION = credentials('AWS_REGION')
        AWS_ACCOUNT_ID = credentials('AWS_ACCOUNT_ID')
        ECR_REPO = credentials('ECR_REPO')
    }

    stages {
        stage('Pull Docker Image from ECR') {
            steps {
                script {
                    withCredentials([
                        string(credentialsId: 'ECR_REPO', variable: 'ECR_REPO')
                    ]) {
                        withAWS(credentials: 'aws-jenkins-cred', region: 'us-east-1') {
                            docker.withRegistry("https://${AWS_ACCOUNT_ID}.dkr.ecr.us-east-1.amazonaws.com", "ecr:us-east-1:aws-jenkins-cred") {
                                sh "docker pull ${AWS_ACCOUNT_ID}.dkr.ecr.us-east-1.amazonaws.com/${IMAGE_NAME}:${IMAGE_TAG}"
                            }
                        }
                    }
                }
            }
        }
    }

    post {
        success {
            echo "Image pulled successfully"
        }
        failure {
            echo "Failed to pull image"
        }
    }
}
